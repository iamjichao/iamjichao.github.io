<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>一次搞懂 JSON.stringify &mdash; FEHub</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/vendor/share.js/dist/css/share.min.css"><link rel="canonical" href="https://fehub.net/2020/12/12/json-stringify/"><link rel="alternate" type="application/atom+xml" title="FEHub" href="https://fehub.net/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/favicon.ico"><meta property="og:title" content="一次搞懂 JSON.stringify"><meta name="keywords" content="["JavaScript"]"><meta name="og:keywords" content="["JavaScript"]"><meta name="description" content="在这里你可以找到 JSON.stringify 的所有常规和非常规的用法。"><meta name="og:description" content="在这里你可以找到 JSON.stringify 的所有常规和非常规的用法。"><meta property="og:url" content="https://fehub.net/2020/12/12/json-stringify/"><meta property="og:site_name" content="FEHub"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2020-12-12"> <script src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://fehub.net/" title="FEHub"><span class="octicon octicon-mark-github"></span> FEHub</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://fehub.net/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://fehub.net/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://fehub.net/wiki/" class=" site-header-nav-item" target="" title="维基">维基</a> <a href="https://fehub.net/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="一次搞懂 JSON.strin"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">一次搞懂 JSON.stringify</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2020/12/12 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://fehub.net/categories/#一次搞懂系列" title="一次搞懂系列">一次搞懂系列</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://fehub.net/categories/#JavaScript" title="JavaScript">JavaScript</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 5133 字，约 15 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:90px;width:90px;border-radius:4px;" src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/images/qrcode.jpg" alt="FEHub" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><p>在这里你可以找到 JSON.stringify 的所有常规和非常规的用法。</p><h2 id="前言">前言</h2><p>先看一个面试题：实现一个对象的 map 函数，类似 <code class="language-plaintext highlighter-rouge">Array.prototype.map</code>，先看答案，然后带着问题往下看。</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_map</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">oThis</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fn</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">function</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">fn</span><span class="p">}</span><span class="s2"> is not a function!`</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">oThis</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}));</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">c</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="na">d</span><span class="p">:</span> <span class="mi">5</span> <span class="p">};</span>

<span class="kd">const</span> <span class="nx">_obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">_map</span><span class="p">((</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">++</span><span class="nx">val</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_obj</span><span class="p">);</span> <span class="c1">// {a: 3, b: 4, c: 5, d: 6}</span>
</code></pre></div></div><p>这里用到了 <code class="language-plaintext highlighter-rouge">JSON.stringify()</code> 方法。通常情况下，我们对它的使用往往局限在对 Object 的序列化，或者使用它对 Object 进行深拷贝。这次我们一次搞懂 <code class="language-plaintext highlighter-rouge">JSON.stringify()</code> 的所有用法。</p><h2 id="jsonstringify">JSON.stringify()</h2><p><code class="language-plaintext highlighter-rouge">JSON.stringify()</code> 方法将一个 JavaScript 对象或值转换为 JSON 字符串，如果指定了一个 replacer 函数，则可以选择性地替换值，或者指定的 replacer 是数组，则可选择性地仅包含数组指定的属性。</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">[,</span> <span class="nx">replacer</span> <span class="p">[,</span> <span class="nx">space</span><span class="p">]])</span>
</code></pre></div></div><h2 id="九个特性">九个特性</h2><p>如果只传一个参数，<code class="language-plaintext highlighter-rouge">JSON.stringify()</code> 将第一个参数的值转换为相应的 JSON 格式，有以下九个特性：</p><ul><li>转换值如果有 <code class="language-plaintext highlighter-rouge">toJSON()</code> 方法，序列化的结果就是这个方法的返回值，忽略其他属性的值。</li><li><code class="language-plaintext highlighter-rouge">Date</code> 对象包含 <code class="language-plaintext highlighter-rouge">toJSON()</code> 方法（同 <code class="language-plaintext highlighter-rouge">Date.toISOString()</code>），因此会被当做字符串处理。</li></ul><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Li Lei</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">toJSON</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">Han Meimei</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="c1">// '"Han Meimei"'</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
<span class="c1">// '"2020-12-05T09:11:20.566Z"'</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">now</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">});</span>
<span class="c1">// '{"now":"2020-12-05T09:11:20.566Z"}'</span>
</code></pre></div></div><ul><li><strong>函数</strong>、<strong>undefined</strong> 以及 <strong>symbol</strong> 单独序列化时会转换为 <code class="language-plaintext highlighter-rouge">undefined</code>，作为数组元素序列化时会转换为 <code class="language-plaintext highlighter-rouge">null</code>，作为对象的属性值序列化时会被忽略。</li><li>当 <strong>symbol</strong> 作为对象的<strong>属性键</strong>序列化时，该属性会被完全忽略掉，即使 <code class="language-plaintext highlighter-rouge">replacer</code> 参数中强制指定了包含它（<code class="language-plaintext highlighter-rouge">replacer</code> 参数我们稍后会说到），序列化时也会忽略。</li><li>因为非数组对象序列化时会忽略一些特殊的值，所以对象的属性不能保证以特定的顺序出现在序列化后的字符串中，数组除外。</li></ul><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="kd">function</span><span class="p">(){});</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{});</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="kc">undefined</span><span class="p">);</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nb">Symbol</span><span class="p">(</span><span class="dl">'</span><span class="s1">stringify</span><span class="dl">'</span><span class="p">));</span>
<span class="c1">// undefined</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
  <span class="na">a</span><span class="p">:</span> <span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">b</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="na">c</span><span class="p">:</span> <span class="nb">Symbol</span><span class="p">(</span><span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">d</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">});</span>
<span class="c1">// '{"a":"stringify"}'</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="nb">Symbol</span><span class="p">(</span><span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span><span class="p">),</span> <span class="kd">function</span><span class="p">(){}]);</span>
<span class="c1">// '["stringify",null,null,null]'</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="p">[</span><span class="nb">Symbol</span><span class="p">(</span><span class="dl">"</span><span class="s2">json</span><span class="dl">"</span><span class="p">)]:</span> <span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span> <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">k</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">symbol</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">v</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="c1">// undefined</span>
</code></pre></div></div><ul><li><strong>NaN</strong>、<strong>Infinity</strong> 格式的数值以及 <strong>null</strong> 都会被当做 <code class="language-plaintext highlighter-rouge">null</code>，单独序列化时会转换为字符串 <code class="language-plaintext highlighter-rouge">"null"</code>，作为数组元素以及对象的属性值序列化时都会转换为 <code class="language-plaintext highlighter-rouge">null</code>。对 <code class="language-plaintext highlighter-rouge">BigInt</code> 类型（大于 2^53-1 的任意大的整数）的值序列化时会抛出 <code class="language-plaintext highlighter-rouge">Uncaught TypeError: Do not know how to serialize a BigInt</code> 。</li></ul><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="kc">NaN</span><span class="p">);</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="kc">Infinity</span><span class="p">);</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="c1">// "null"</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
  <span class="na">a</span><span class="p">:</span> <span class="kc">NaN</span><span class="p">,</span>
  <span class="na">b</span><span class="p">:</span> <span class="kc">Infinity</span><span class="p">,</span>
  <span class="na">c</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">});</span>
<span class="c1">// '{"a":null,"b":null,"c":null}'</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="kc">NaN</span><span class="p">,</span> <span class="kc">Infinity</span><span class="p">,</span> <span class="kc">null</span><span class="p">]);</span>
<span class="c1">// '[null,null,null]'</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="mi">1</span><span class="nx">n</span><span class="p">);</span>
<span class="c1">// Uncaught TypeError: Do not know how to serialize a BigInt</span>
</code></pre></div></div><ul><li><strong>布尔值</strong>、<strong>数字</strong>、<strong>字符串</strong>的包装对象作为数组元素以及对象的属性值序列化时会自动转换成对应的原始值，单独序列化时会转化为对应的字符串。</li></ul><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="c1">// '1'</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="dl">"</span><span class="s2">false</span><span class="dl">"</span><span class="p">));</span>
<span class="c1">// '"false"'</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">false</span><span class="p">));</span>
<span class="c1">// 'false'</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
	<span class="na">a</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	<span class="na">b</span><span class="p">:</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="dl">"</span><span class="s2">false</span><span class="dl">"</span><span class="p">),</span>
	<span class="na">c</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="p">});</span>
<span class="c1">// '{"a":1,"b":"false","c":false}'</span>

<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">([</span><span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="dl">"</span><span class="s2">false</span><span class="dl">"</span><span class="p">),</span> <span class="k">new</span> <span class="nb">Boolean</span><span class="p">(</span><span class="kc">false</span><span class="p">)]);</span>
<span class="c1">// '[1,"false",false]'</span>
</code></pre></div></div><ul><li>其他类型的对象，包括 <strong>Map</strong>/<strong>Set</strong>/<strong>WeakMap</strong>/<strong>WeakSet</strong>，仅会序列化可枚举的属性。</li></ul><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">a</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="p">,</span> <span class="na">enumerable</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
    <span class="na">b</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">stringify</span><span class="dl">'</span><span class="p">,</span> <span class="na">enumerable</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}</span>
  <span class="p">})</span>
<span class="p">);</span>
<span class="c1">// '{"b":"stringify"}'</span>
</code></pre></div></div><ul><li>对包含循环引用的对象（对象之间相互引用，形成无限循环）执行此方法，会抛出错误。当我们试图通过 <code class="language-plaintext highlighter-rouge">JSON.parse(JSON.stringify())</code> 方法实现深拷贝时，要注意对象不能包含循环引用，否则会报错。</li></ul><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Uncaught TypeError: Converting circular structure to JSON</span>
</code></pre></div></div><h2 id="第二个参数">第二个参数</h2><p>接下来看第二个和第三个参数。两个参数都是可选的。</p><p>第二个参数 <code class="language-plaintext highlighter-rouge">replacer</code> 可以是一个函数，也可以是一个数组。</p><ul><li>当它是一个函数时，它有两个参数，键（key）和值（value），被序列化的值的每个属性都会经过该函数的处理，类似于数组方法 <code class="language-plaintext highlighter-rouge">map</code>、<code class="language-plaintext highlighter-rouge">filter</code> 等方法的回调函数。</li><li>当它是一个数组时，只有数组中包含的属性名才会被序列化到 JSON 字符串中。</li><li>当它是 null 或者未传时，对象所有的属性都会被序列化。</li></ul><p>通过 <code class="language-plaintext highlighter-rouge">replacer</code> 参数，我们可以打破上述九个特性中的一些特性。</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">a</span><span class="p">:</span> <span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">b</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="na">c</span><span class="p">:</span> <span class="nb">Symbol</span><span class="p">(</span><span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">d</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="c1">// 不用 replacer 参数时</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="c1">// '{"a":"stringify"}'</span>

<span class="c1">// 使用 replacer 参数时</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">:</span>
      <span class="k">return</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">case</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">symbol</span><span class="dl">"</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="k">case</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">function</span><span class="dl">"</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">});</span>
<span class="c1">// '{"a":"stringify","b":"undefined","c":"Symbol(stringify)","d":"function() {}"}'</span>
</code></pre></div></div><p>需要注意的是，<code class="language-plaintext highlighter-rouge">replacer</code> 传入函数时，第一个参数不是对象的第一个键值对，而是空字符串作为 key 值，value 值是整个对象的键值对：</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">c</span><span class="p">:</span> <span class="mi">3</span> <span class="p">};</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">});</span>
<span class="c1">// 第一个传入 replacer 函数的是 {"":{a:1,b:2,c:3}}</span>
<span class="c1">// { a: 1, b: 2, c: 3 }   </span>
<span class="c1">// 1</span>
<span class="c1">// 2</span>
<span class="c1">// 3</span>
</code></pre></div></div><p>这时候我们再返回开头看看实现 Object.map 的方法，是不是恍然大悟呢？</p><p>当 <code class="language-plaintext highlighter-rouge">replacer</code> 是一个数组时，很简单，只会序列化数组中包含的属性值。</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="dl">"</span><span class="s2">JSON</span><span class="dl">"</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span> <span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span> <span class="p">};</span>

<span class="c1">// 只保留 b 属性的值</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">]);</span>
<span class="c1">// '{"b":"stringify"}'</span>
</code></pre></div></div><h2 id="第三个参数">第三个参数</h2><p>第三个参数 <code class="language-plaintext highlighter-rouge">space</code> 指定缩进用的空白字符串，用于美化输出，它可以是数字，也可以是字符串。这个参数用处不大。</p><ul><li>如果参数是数字，代表缩进有多少个空格，最大是 10，小于 1 则没有空格。</li><li>如果参数是字符串，那么这个字符串将作为缩进的空格，当字符串超过 10 个字母时，取它的前 10 个字母。</li><li>如果参数没有或者为 null，将没有空格。</li></ul><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span> <span class="na">a</span><span class="p">:</span> <span class="dl">"</span><span class="s2">JSON</span><span class="dl">"</span><span class="p">,</span> <span class="na">b</span><span class="p">:</span> <span class="dl">"</span><span class="s2">stringify</span><span class="dl">"</span> <span class="p">};</span>

<span class="c1">// 缩进有 12 个空格</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="c1">// '{\n          "a": "JSON",\n          "b": "stringify"\n}'</span>

<span class="c1">// 用'a'代替缩进的空格</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// '{\na"a": "JSON",\na"b": "stringify"\n}'</span>
</code></pre></div></div><h2 id="举一反三">举一反三</h2><h3 id="json-对象">JSON 对象</h3><p><code class="language-plaintext highlighter-rouge">JSON</code> 是一种语法，用来序列化对象、数组、数值、字符串、布尔值和 <code class="language-plaintext highlighter-rouge">null</code> 。<code class="language-plaintext highlighter-rouge">JSON</code> 对象包含两个方法：<code class="language-plaintext highlighter-rouge">parse</code> 和 <code class="language-plaintext highlighter-rouge">stringify</code>。除了这两个方法，<code class="language-plaintext highlighter-rouge">JSON</code> 这个对象本身并没有其他作用，也不能被调用或者作为构造函数调用。</p><p><code class="language-plaintext highlighter-rouge">JSON</code> 基于 JavaScript 语法，但 JSON 不是 JavaScript，JavaScript 也不是 JSON。</p><ul><li>对象和数组：属性名称必须是双引号括起来的字符串；最后一个属性后不能有逗号。</li><li>数值：不能出现前导零；如果有小数点，后面至少跟着一位数字。</li><li>字符串：字符串必须用双引号括起来。</li></ul><h3 id="jsonparse">JSON.parse()</h3><p><code class="language-plaintext highlighter-rouge">JSON.parse()</code> 方法用来解析 JSON 字符串，构造由字符串描述的 JavaScript 值或对象。</p><h4 id="语法">语法</h4><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">text</span><span class="p">[,</span> <span class="nx">reviver</span><span class="p">])</span>
</code></pre></div></div><h4 id="参数">参数</h4><ul><li><strong><code class="language-plaintext highlighter-rouge">text</code></strong></li></ul><p>要被解析成 JavaScript 值的字符串，必须符合 JSON 的语法格式。</p><ul><li><strong><code class="language-plaintext highlighter-rouge">reviver</code> 可选</strong></li></ul><p>转换器函数，如果传入该函数，可以用来修改解析生成的原始值，在 parse 返回之前调用。这个函数的遍历顺序从最内层开始，按照层级顺序，依次向外遍历，当遍历到最顶层的解析值时，传入 <code class="language-plaintext highlighter-rouge">reviver</code> 函数的参数是空字符串和当前的解析值（有可能已经被修改过了）。</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="dl">'</span><span class="s1">{"p": 5}</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">k</span> <span class="o">===</span> <span class="dl">''</span><span class="p">)</span> <span class="k">return</span> <span class="nx">v</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">v</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>
<span class="c1">// { p: 10 }</span>
</code></pre></div></div><h4 id="返回值">返回值</h4><ul><li>Object 类型，对应给定 JSON 文本的对象/值。</li></ul><h4 id="异常">异常</h4><ul><li>若传入的字符串不符合 JSON 规范，则会抛出 SyntaxError 异常。</li></ul><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 不允许用逗号作为结尾</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="dl">"</span><span class="s2">[1, 2, 3, 4, ]</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="dl">'</span><span class="s1">{"foo" : 1, }</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div><p>以上。</p><h2 id="参考资料">参考资料</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">JSON.stringify() - MDN</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON">JSON - MDN</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse() - MDN</a></li><li><a href="https://github.com/NieZhuZhu/Blog/issues/1">你不知道的 JSON.stringify() 的威力</a></li></ul><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://fehub.net" target="_blank">Ji Chao</a></li><li>本文链接：<a href="https://fehub.net/2020/12/12/json-stringify/" target="_blank">https://fehub.net/2020/12/12/json-stringify/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"><div class="share-component" data-disabled='douban,qzone,linkedin'></div></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2020/12/12/json-stringify/', clientID: '5a841e8a87b06d346f3d', clientSecret: 'e0f22a1087ecec4dc50679f89f726b79e76bb628', repo: 'blog-comments', owner: 'iamjichao', admin: ['iamjichao'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:98%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@built/assets/search_data.json?v=1710948529', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2018 <span title="Ji Chao">Ji Chao</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/iamjichao/iamjichao.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://fehub.net/" title="首页" target="">首页</a></li><li> <a href="https://fehub.net/categories/" title="分类" target="">分类</a></li><li> <a href="https://fehub.net/wiki/" title="维基" target="">维基</a></li><li> <a href="https://fehub.net/about/" title="关于" target="">关于</a></li><li><a href="https://fehub.net/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 统计始于2020-01-01 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/iamjichao/iamjichao.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
